<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato%7cLibre+Baskerville%7cMerriweather:100,300,400%7cMerriweather+Sans:100,300,400%7cShare+Tech+Mono%7cRoboto"/>
        <link rel="stylesheet" href="/bundle/imandraViewerApp.css" />
    </head>
    <body>
        <div style="display: flex; justify-content: space-between; align-items: center; font-family: 'Roboto'; padding: 1em">
            <div>
                <h1>IPL Viewer</h1>
                <a href="/">Upload a new bundle</a>
            </div>
            <form id="handle-selection" method="POST" action="/api/select-cases">
                <input type="submit"  value="Handle selection">
            </form>
        </div>
        <div id="app"></div>
        <script src="/bundle/imandraViewerApp.js"></script>
        <script>
         var selection;

         var handleSelectionForm = document.getElementById('handle-selection');
         handleSelectionForm.addEventListener('submit', function (e) {
             e.preventDefault();
             fetch('/api/select-cases', {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify({ cases: selection })
             });
         });

         if (window.renderImandraApp) {

             fetch('/bundle/decomposition_tree_pp.json').then(function (res) {
                 return res.json();
             }).then(function (json) {
                 window.renderImandraApp({
                     targetId: "app",
                     basePath: "/app",
                     jsonData: json,
                     onSelectionChanged: function (s) {
                         selection = s;
                     },
                     caseDetailsUrl: function (caseId, testgenInfo) {
                         return "/api/case/" + testgenInfo.testScriptFilename;
                     }
                 })
             });
         } else {
             window.location.pathname = '/upload.html'
         }
        </script>
    </body>
</html>
